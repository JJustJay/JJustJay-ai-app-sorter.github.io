<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Data Sorter</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
    }
    * {
      font-family: 'Space Grotesk', sans-serif;
    }
    .data-item {
      cursor: grab;
      transition: all 0.2s ease;
      user-select: none;
    }
    .data-item:active {
      cursor: grabbing;
    }
    .data-item.dragging {
      opacity: 0.5;
      transform: scale(1.05);
    }
    .pile-zone {
      transition: all 0.3s ease;
    }
    .pile-zone.drag-over {
      transform: scale(1.02);
      box-shadow: 0 0 0 3px currentColor;
    }
    .pile-item {
      animation: popIn 0.3s ease-out;
    }
    @keyframes popIn {
      0% { transform: scale(0); opacity: 0; }
      70% { transform: scale(1.1); }
      100% { transform: scale(1); opacity: 1; }
    }
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }
    .float-animation {
      animation: float 3s ease-in-out infinite;
    }
    .sorted-count {
      transition: transform 0.2s ease;
    }
    .sorted-count.bump {
      transform: scale(1.2);
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <div id="app-wrapper" class="h-full w-full overflow-auto" style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);">
   <div class="min-h-full p-6 md:p-8"><!-- Header -->
    <header class="text-center mb-8">
     <h1 id="main-title" class="text-3xl md:text-4xl font-bold text-white mb-2">Data Sorter</h1>
     <p id="instruction-text" class="text-slate-300 text-lg">Drag items to their matching category pile</p>
    </header><!-- Main Content Grid -->
    <div class="max-w-7xl mx-auto mb-6 grid grid-cols-1 lg:grid-cols-3 gap-6"><!-- Import Data Section (Left - 2 columns) -->
     <div class="lg:col-span-2">
      <div class="bg-slate-800/50 rounded-2xl p-6 border border-slate-700">
       <div class="flex items-center gap-2 mb-4"><span class="text-2xl">ğŸ“‹</span>
        <h2 class="text-white font-semibold text-lg">Import Data</h2>
       </div>
       <p class="text-slate-300 text-sm mb-4">Paste data from Excel, CSV, JSON, or plain text. Each line or value will be automatically detected and sorted.</p>
       <div class="space-y-4"><textarea id="import-textarea" placeholder="Paste your data here... (e.g., numbers, emails, dates, text - one per line or comma-separated)" class="w-full h-32 px-4 py-3 bg-slate-900/70 text-white rounded-xl border-2 border-slate-600 focus:border-purple-500 focus:outline-none resize-none font-mono text-sm"></textarea>
        <div class="flex gap-3"><button id="auto-sort-btn" class="flex-1 px-6 py-3 bg-gradient-to-r from-purple-600 to-cyan-600 hover:from-purple-700 hover:to-cyan-700 text-white rounded-xl font-medium transition-all transform hover:scale-105"> ğŸš€ Auto-Sort Data </button> <button id="clear-import-btn" class="px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-xl font-medium transition-colors"> Clear </button>
        </div>
       </div><!-- Detection Info -->
       <div id="detection-info" class="hidden mt-4 p-3 bg-slate-900/50 rounded-lg border border-slate-600">
        <p class="text-slate-300 text-sm"><span class="font-semibold text-white">Detected:</span> <span id="detected-numbers" class="ml-2">0 numbers</span>, <span id="detected-text" class="ml-1">0 text</span>, <span id="detected-dates" class="ml-1">0 dates</span>, <span id="detected-emails" class="ml-1">0 emails</span></p>
       </div>
      </div>
     </div><!-- AI Helper Section (Right - 1 column) -->
     <div class="lg:col-span-1">
      <div class="bg-gradient-to-br from-indigo-900/30 to-purple-900/30 rounded-2xl p-6 border border-indigo-500/50 h-full flex flex-col">
       <div class="flex items-center gap-2 mb-4"><span class="text-2xl">ğŸ¤–</span>
        <h2 class="text-white font-semibold text-lg">AI Helper</h2>
       </div>
       <div id="ai-chat-container" class="flex-1 bg-slate-900/50 rounded-xl p-4 mb-4 overflow-y-auto min-h-[200px] max-h-[300px] space-y-3">
        <div class="ai-message text-slate-300 text-sm p-3 bg-indigo-800/30 rounded-lg"><strong class="text-indigo-300">AI:</strong> Hi! I'm here to help you sort your data. Try asking me things like:
         <ul class="mt-2 ml-4 space-y-1 text-xs">
          <li>â€¢ "What data types can you detect?"</li>
          <li>â€¢ "How do I import CSV data?"</li>
          <li>â€¢ "What's the best way to organize emails?"</li>
         </ul>
        </div>
       </div>
       <div class="space-y-3"><textarea id="ai-input" placeholder="Ask me anything about sorting data..." class="w-full h-20 px-3 py-2 bg-slate-900/70 text-white rounded-lg border border-indigo-500/30 focus:border-indigo-500 focus:outline-none resize-none text-sm"></textarea> <button id="ai-send-btn" class="w-full px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white rounded-lg font-medium transition-all"> Send Message </button>
       </div><!-- Quick Actions -->
       <div class="mt-4 pt-4 border-t border-indigo-500/30">
        <p class="text-slate-400 text-xs mb-2">Quick Actions:</p>
        <div class="flex flex-wrap gap-2"><button class="ai-quick-btn text-xs px-3 py-1 bg-indigo-700/50 hover:bg-indigo-600/50 text-indigo-200 rounded-full transition-colors"> Detect types </button> <button class="ai-quick-btn text-xs px-3 py-1 bg-indigo-700/50 hover:bg-indigo-600/50 text-indigo-200 rounded-full transition-colors"> Help import </button> <button class="ai-quick-btn text-xs px-3 py-1 bg-indigo-700/50 hover:bg-indigo-600/50 text-indigo-200 rounded-full transition-colors"> Clear all </button>
        </div>
       </div>
      </div>
     </div>
    </div><!-- Unsorted Items Area -->
    <div class="max-w-4xl mx-auto mb-8">
     <div class="bg-slate-800/50 rounded-2xl p-6 border border-slate-700">
      <div class="flex items-center justify-between mb-4">
       <h2 class="text-white font-semibold text-lg flex items-center gap-2"><span class="text-2xl">ğŸ“¥</span> Unsorted Items</h2><button id="reset-btn" class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg text-sm font-medium transition-colors"> Reset All </button>
      </div>
      <div id="unsorted-area" class="flex flex-wrap gap-3 min-h-[80px] p-4 bg-slate-900/50 rounded-xl border-2 border-dashed border-slate-600"><!-- Items will be generated here -->
      </div>
     </div>
    </div><!-- Sorting Piles -->
    <div class="max-w-6xl mx-auto grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6"><!-- Numbers Pile -->
     <div class="pile-zone rounded-2xl p-4 border-2" style="background: linear-gradient(180deg, #7c3aed20 0%, #7c3aed10 100%); border-color: #7c3aed;" data-category="numbers">
      <div class="text-center mb-3"><span class="text-3xl float-animation inline-block">ğŸ”¢</span>
       <h3 class="text-white font-semibold mt-1">Numbers</h3><span class="sorted-count text-xs text-purple-300" data-count="numbers">0 items</span>
      </div>
      <div class="pile-items space-y-2 min-h-[120px]" data-pile="numbers"></div>
     </div><!-- Text Pile -->
     <div class="pile-zone rounded-2xl p-4 border-2" style="background: linear-gradient(180deg, #06b6d420 0%, #06b6d410 100%); border-color: #06b6d4;" data-category="text">
      <div class="text-center mb-3"><span class="text-3xl float-animation inline-block" style="animation-delay: 0.5s;">ğŸ“</span>
       <h3 class="text-white font-semibold mt-1">Text</h3><span class="sorted-count text-xs text-cyan-300" data-count="text">0 items</span>
      </div>
      <div class="pile-items space-y-2 min-h-[120px]" data-pile="text"></div>
     </div><!-- Dates Pile -->
     <div class="pile-zone rounded-2xl p-4 border-2" style="background: linear-gradient(180deg, #f5918720 0%, #f5918710 100%); border-color: #f59187;" data-category="dates">
      <div class="text-center mb-3"><span class="text-3xl float-animation inline-block" style="animation-delay: 1s;">ğŸ“…</span>
       <h3 class="text-white font-semibold mt-1">Dates</h3><span class="sorted-count text-xs text-orange-300" data-count="dates">0 items</span>
      </div>
      <div class="pile-items space-y-2 min-h-[120px]" data-pile="dates"></div>
     </div><!-- Emails Pile -->
     <div class="pile-zone rounded-2xl p-4 border-2" style="background: linear-gradient(180deg, #22c55e20 0%, #22c55e10 100%); border-color: #22c55e;" data-category="emails">
      <div class="text-center mb-3"><span class="text-3xl float-animation inline-block" style="animation-delay: 1.5s;">âœ‰ï¸</span>
       <h3 class="text-white font-semibold mt-1">Emails</h3><span class="sorted-count text-xs text-green-300" data-count="emails">0 items</span>
      </div>
      <div class="pile-items space-y-2 min-h-[120px]" data-pile="emails"></div>
     </div>
    </div><!-- Progress Bar -->
    <div class="max-w-4xl mx-auto mt-8">
     <div class="bg-slate-800/50 rounded-xl p-4 border border-slate-700">
      <div class="flex items-center justify-between mb-2"><span class="text-white font-medium">Sorting Progress</span> <span id="progress-text" class="text-slate-300 text-sm">0%</span>
      </div>
      <div class="h-3 bg-slate-700 rounded-full overflow-hidden">
       <div id="progress-bar" class="h-full bg-gradient-to-r from-purple-500 via-cyan-500 to-green-500 rounded-full transition-all duration-500" style="width: 0%"></div>
      </div>
     </div>
    </div><!-- Completion Message -->
    <div id="completion-message" class="hidden max-w-4xl mx-auto mt-6 text-center">
     <div class="bg-gradient-to-r from-purple-500/20 via-cyan-500/20 to-green-500/20 rounded-2xl p-6 border border-white/20"><span class="text-5xl mb-3 inline-block">ğŸ‰</span>
      <h2 class="text-2xl font-bold text-white mb-2">All Sorted!</h2>
      <p class="text-slate-300">Great job organizing all the data!</p>
     </div>
    </div>
   </div>
  </div>
  <script>
    const defaultConfig = {
      main_title: 'Data Sorter',
      instruction_text: 'Drag items to their matching category pile',
      background_color: '#1a1a2e',
      text_color: '#ffffff',
      accent_color: '#7c3aed',
      surface_color: '#1e293b',
      secondary_color: '#334155'
    };

    let config = { ...defaultConfig };

    const sampleData = [
      { value: '42', category: 'numbers' },
      { value: '3.14159', category: 'numbers' },
      { value: '2024', category: 'numbers' },
      { value: '-17', category: 'numbers' },
      { value: 'Hello World', category: 'text' },
      { value: 'JavaScript', category: 'text' },
      { value: 'Data Science', category: 'text' },
      { value: 'Machine Learning', category: 'text' },
      { value: '2024-01-15', category: 'dates' },
      { value: 'Dec 25, 2023', category: 'dates' },
      { value: '03/14/2024', category: 'dates' },
      { value: 'user@email.com', category: 'emails' },
      { value: 'hello@world.org', category: 'emails' },
      { value: 'test@example.net', category: 'emails' }
    ];

    let items = [];
    let draggedItem = null;

    const categoryColors = {
      numbers: { bg: '#7c3aed', light: '#7c3aed40' },
      text: { bg: '#06b6d4', light: '#06b6d440' },
      dates: { bg: '#f59187', light: '#f5918740' },
      emails: { bg: '#22c55e', light: '#22c55e40' }
    };

    function shuffleArray(array) {
      const shuffled = [...array];
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      return shuffled;
    }

    function initializeItems() {
      // Try to load from localStorage first
      const savedItems = localStorage.getItem('dataSorterItems');
     
      if (savedItems) {
        items = JSON.parse(savedItems);
        renderUnsortedItems();
        renderSortedItems();
        updateProgress();
      } else {
        // First time - use sample data
        items = shuffleArray(sampleData).map((item, index) => ({
          ...item,
          id: `item-${index}`,
          sorted: false
        }));
        renderUnsortedItems();
        clearPiles();
        updateProgress();
        saveToLocalStorage();
      }
     
      document.getElementById('completion-message').classList.add('hidden');
    }

    function saveToLocalStorage() {
      localStorage.setItem('dataSorterItems', JSON.stringify(items));
    }

    function renderSortedItems() {
      // Render already sorted items into their piles
      clearPiles();
      items.filter(item => item.sorted).forEach(item => {
        const pile = document.querySelector(`[data-pile="${item.category}"]`);
        if (pile) {
          const pileItem = document.createElement('div');
          pileItem.className = 'pile-item px-3 py-1.5 rounded-lg text-xs font-medium text-white text-center truncate';
          pileItem.style.background = categoryColors[item.category].bg;
          pileItem.textContent = item.value;
          pile.appendChild(pileItem);
        }
      });
      updateCounts();
    }

    function createItemElement(item) {
      const el = document.createElement('div');
      el.className = 'data-item px-4 py-2 rounded-lg text-sm font-medium text-white';
      el.style.background = categoryColors[item.category].light;
      el.style.border = `2px solid ${categoryColors[item.category].bg}`;
      el.draggable = true;
      el.dataset.id = item.id;
      el.dataset.category = item.category;
      el.textContent = item.value;

      el.addEventListener('dragstart', handleDragStart);
      el.addEventListener('dragend', handleDragEnd);

      return el;
    }

    function renderUnsortedItems() {
      const container = document.getElementById('unsorted-area');
      container.innerHTML = '';
      items.filter(item => !item.sorted).forEach(item => {
        container.appendChild(createItemElement(item));
      });
    }

    function clearPiles() {
      document.querySelectorAll('.pile-items').forEach(pile => {
        pile.innerHTML = '';
      });
      updateCounts();
    }

    function handleDragStart(e) {
      draggedItem = e.target;
      e.target.classList.add('dragging');
      e.dataTransfer.effectAllowed = 'move';
      e.dataTransfer.setData('text/plain', e.target.dataset.id);
    }

    function handleDragEnd(e) {
      e.target.classList.remove('dragging');
      draggedItem = null;
      document.querySelectorAll('.pile-zone').forEach(zone => {
        zone.classList.remove('drag-over');
      });
    }

    function handleDragOver(e) {
      e.preventDefault();
      e.dataTransfer.dropEffect = 'move';
    }

    function handleDragEnter(e) {
      e.preventDefault();
      const zone = e.target.closest('.pile-zone');
      if (zone) {
        zone.classList.add('drag-over');
      }
    }

    function handleDragLeave(e) {
      const zone = e.target.closest('.pile-zone');
      if (zone && !zone.contains(e.relatedTarget)) {
        zone.classList.remove('drag-over');
      }
    }

    function handleDrop(e) {
      e.preventDefault();
      const zone = e.target.closest('.pile-zone');
      if (!zone || !draggedItem) return;

      zone.classList.remove('drag-over');

      const itemId = draggedItem.dataset.id;
      const itemCategory = draggedItem.dataset.category;
      const pileCategory = zone.dataset.category;

      if (itemCategory === pileCategory) {
        const item = items.find(i => i.id === itemId);
        if (item) {
          item.sorted = true;
         
          const pile = zone.querySelector('.pile-items');
          const pileItem = document.createElement('div');
          pileItem.className = 'pile-item px-3 py-1.5 rounded-lg text-xs font-medium text-white text-center truncate';
          pileItem.style.background = categoryColors[itemCategory].bg;
          pileItem.textContent = item.value;
          pile.appendChild(pileItem);

          draggedItem.remove();
          updateCounts();
          updateProgress();
          saveToLocalStorage();

          const countEl = zone.querySelector('.sorted-count');
          countEl.classList.add('bump');
          setTimeout(() => countEl.classList.remove('bump'), 200);
        }
      } else {
        draggedItem.style.animation = 'none';
        draggedItem.offsetHeight;
        draggedItem.style.animation = '';
        draggedItem.style.transform = 'translateX(-5px)';
        setTimeout(() => {
          draggedItem.style.transform = 'translateX(5px)';
          setTimeout(() => {
            draggedItem.style.transform = '';
          }, 100);
        }, 100);
      }
    }

    function updateCounts() {
      const categories = ['numbers', 'text', 'dates', 'emails'];
      categories.forEach(cat => {
        const count = items.filter(i => i.category === cat && i.sorted).length;
        const countEl = document.querySelector(`[data-count="${cat}"]`);
        if (countEl) {
          countEl.textContent = `${count} item${count !== 1 ? 's' : ''}`;
        }
      });
    }

    function updateProgress() {
      const sorted = items.filter(i => i.sorted).length;
      const total = items.length;
      const percent = Math.round((sorted / total) * 100);
     
      document.getElementById('progress-bar').style.width = `${percent}%`;
      document.getElementById('progress-text').textContent = `${percent}%`;

      if (percent === 100) {
        document.getElementById('completion-message').classList.remove('hidden');
      }
    }

    function detectDataType(value) {
      const trimmed = value.trim();
      if (!trimmed) return null;

      // Email detection
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (emailRegex.test(trimmed)) {
        return 'emails';
      }

      // Date detection (multiple formats)
      const dateRegex = /^\d{4}-\d{2}-\d{2}$/; // YYYY-MM-DD
      const dateRegex2 = /^\d{1,2}\/\d{1,2}\/\d{2,4}$/; // MM/DD/YYYY or M/D/YY
      const dateRegex3 = /^(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s+\d{1,2},?\s+\d{4}$/i; // Dec 25, 2024
     
      if (dateRegex.test(trimmed) || dateRegex2.test(trimmed) || dateRegex3.test(trimmed)) {
        return 'dates';
      }

      // Number detection (including decimals and negatives)
      const numberRegex = /^-?\d+(\.\d+)?$/;
      if (numberRegex.test(trimmed)) {
        return 'numbers';
      }

      // Default to text
      return 'text';
    }

    function parseImportedData(rawText) {
      let values = [];

      // Try to detect JSON format
      try {
        const parsed = JSON.parse(rawText);
        if (Array.isArray(parsed)) {
          values = parsed.map(v => String(v));
        } else if (typeof parsed === 'object') {
          values = Object.values(parsed).map(v => String(v));
        }
      } catch (e) {
        // Not JSON, try CSV/TSV or line-separated
        const lines = rawText.split(/[\n\r]+/);
       
        lines.forEach(line => {
          // Check for comma, tab, or semicolon separated
          if (line.includes(',') || line.includes('\t') || line.includes(';')) {
            const separator = line.includes('\t') ? '\t' : (line.includes(';') ? ';' : ',');
            const parts = line.split(separator);
            values.push(...parts);
          } else {
            values.push(line);
          }
        });
      }

      // Filter out empty values and detect types
      const detectedItems = values
        .map(v => v.trim())
        .filter(v => v.length > 0)
        .map((value, index) => ({
          value,
          category: detectDataType(value),
          id: `imported-${Date.now()}-${index}`,
          sorted: false
        }))
        .filter(item => item.category !== null);

      return detectedItems;
    }

    function autoSortData() {
      const textarea = document.getElementById('import-textarea');
      const rawText = textarea.value;

      if (!rawText.trim()) {
        return;
      }

      const newItems = parseImportedData(rawText);
     
      if (newItems.length === 0) {
        return;
      }

      // Count detected types
      const counts = {
        numbers: newItems.filter(i => i.category === 'numbers').length,
        text: newItems.filter(i => i.category === 'text').length,
        dates: newItems.filter(i => i.category === 'dates').length,
        emails: newItems.filter(i => i.category === 'emails').length
      };

      // Show detection info
      document.getElementById('detected-numbers').textContent = `${counts.numbers} numbers`;
      document.getElementById('detected-text').textContent = `${counts.text} text`;
      document.getElementById('detected-dates').textContent = `${counts.dates} dates`;
      document.getElementById('detected-emails').textContent = `${counts.emails} emails`;
      document.getElementById('detection-info').classList.remove('hidden');

      // Add to items array
      items.push(...newItems);

      // Automatically sort the items into piles
      newItems.forEach(item => {
        item.sorted = true;
        const pile = document.querySelector(`[data-pile="${item.category}"]`);
        if (pile) {
          const pileItem = document.createElement('div');
          pileItem.className = 'pile-item px-3 py-1.5 rounded-lg text-xs font-medium text-white text-center truncate';
          pileItem.style.background = categoryColors[item.category].bg;
          pileItem.textContent = item.value;
          pile.appendChild(pileItem);
        }
      });

      updateCounts();
      updateProgress();
      textarea.value = '';
      saveToLocalStorage();

      // Animate the piles
      document.querySelectorAll('.sorted-count').forEach(el => {
        el.classList.add('bump');
        setTimeout(() => el.classList.remove('bump'), 200);
      });
    }

    function setupEventListeners() {
      document.querySelectorAll('.pile-zone').forEach(zone => {
        zone.addEventListener('dragover', handleDragOver);
        zone.addEventListener('dragenter', handleDragEnter);
        zone.addEventListener('dragleave', handleDragLeave);
        zone.addEventListener('drop', handleDrop);
      });
